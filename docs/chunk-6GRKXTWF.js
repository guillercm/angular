import{a as gt}from"./chunk-HUYJNUJC.js";import{a as ft,c as Ct,d as _t,f as ht,g as bt,h as vt,i as Ft,k as I}from"./chunk-LKWVCNZG.js";import{a as Q,b as ut}from"./chunk-HQ6BEVK7.js";import{$b as U,Ac as g,Ba as Y,Bc as m,Cc as mt,Da as y,Db as T,Dd as P,Ec as A,Gc as ct,Ia as Z,Ic as pt,Ja as h,Jb as l,Ka as a,L as J,Ma as tt,Na as D,Q as W,Tb as ot,Ub as d,Wb as nt,Yb as C,Yc as c,Zb as it,_b as rt,ac as $,bc as b,cc as v,da as X,dc as N,ec as F,f as H,fc as j,hc as M,ic as s,ka as p,md as B,pb as i,pc as L,pd as dt,qc as G,rc as at,sc as st,tc as lt,va as w,wa as S,wb as _,xb as E,yb as et,zc as x}from"./chunk-MHIS6V2U.js";var Vt=["container"],O=class n{_injector=p(Y);_container=E("container",{read:_});_destroyRef=p(y);_patoFormComponent=p(R);formControlName=a.required();_componentRef;_componentRefFormField;_componentInstance=c(()=>this._componentRef?.instance);_id=c(()=>this._patoFormComponent.identifier()+"_"+this.formControlName());_form=c(()=>this._patoFormComponent.form());_data=c(()=>this._patoFormComponent.data().controls[this.formControlName()]);_control=c(()=>this._form()?.controls[this.formControlName()]);ngOnInit(){this.initialize()}initialize(){this.createComponents(),this.setInputsOutputs(),this.setClasses()}createComponents(){let{component:t,formFieldComponent:e}=this._data(),o=this._container();if(!e||!o)return;console.log(o),this._componentRefFormField=o.createComponent(e),this._componentRefFormField.setInput("control",this._control()),this._componentRefFormField.setInput("id",this._id());let r=this._componentRefFormField.instance;this._componentRef=r.controlView().createComponent(t),console.log(this._componentRef),this._componentRef.setInput("formField",this._componentRefFormField.instance)}setInputsOutputs(){let t=this._data().args;if(!t)return;let{control:e={},formField:o={}}=t,r=this._componentRef,u=this._componentRefFormField,f=(K,z)=>{Object.keys(K).forEach(k=>{let V=K[k],q=z.instance[k];switch(typeof q){case"function":if(tt(V)){let Rt=ut(V,{injector:this._injector}).subscribe(()=>z.setInput(k,V()));this._destroyRef.onDestroy(()=>Rt.unsubscribe())}else z.setInput(k,V);break;case"object":if(!(q instanceof Z))return;let Ot=q.subscribe(V);this._destroyRef.onDestroy(()=>Ot.unsubscribe())}})};f(e,r),f(o,u)}setClasses(){let t=this._data().classes;if(!t)return;let{control:e,formField:o}=t;e&&(this._componentRef.location.nativeElement.classList=e),o&&(this._componentRefFormField.location.nativeElement.classList=o)}writeValue(t){this._componentInstance().writeValue(t)}registerOnChange(t){this._componentInstance().registerOnChange(t)}registerOnTouched(t){this._componentInstance().registerOnTouched(t)}setDisabledState(t){this._componentInstance()?.setDisabledState?.(t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=T({type:n,selectors:[["pato-control"]],viewQuery:function(e,o){e&1&&L(o._container,Vt,5,_),e&2&&G()},inputs:{formControlName:[1,"formControlName"]},features:[mt([{provide:ft,useExisting:X(()=>n),multi:!0}])],decls:2,vars:0,consts:[["container",""]],template:function(e,o){e&1&&F(0,null,0)},dependencies:[P,I],encapsulation:2})};var St=["container"],xt=n=>({formValid:n}),Pt=n=>({controlValid:n});function Dt(n,t){n&1&&F(0)}function Nt(n,t){if(n&1&&l(0,Dt,1,0,"ng-container",3),n&2){s();let e=m(1);s();let o=m(0);d("ngTemplateOutlet",e)("ngTemplateOutletContext",A(2,xt,o.valid))}}function Lt(n,t){n&1&&F(0)}function At(n,t){if(n&1&&l(0,Lt,1,0,"ng-container",3),n&2){s();let e=m(0),o=m(1);d("ngTemplateOutlet",e)("ngTemplateOutletContext",A(2,Pt,o))}}function kt(n,t){n&1&&F(0)}function Et(n,t){if(n&1&&l(0,kt,1,0,"ng-container",3),n&2){s();let e=m(1),o=m(4);d("ngTemplateOutlet",o)("ngTemplateOutletContext",A(2,Pt,e))}}function jt(n,t){if(n&1&&(x(0)(1),l(2,At,1,4,"ng-container"),N(3,"pato-control",4),x(4),l(5,Et,1,4,"ng-container")),n&2){let e=t.$implicit,o=s(2),r=m(0),u=g(o.templates()["before_"+e]);i(),g(r.controls[e].valid),i(),C(u?2:-1),i(),d("formControlName",e),i();let f=g(o.templates()["after_"+e]);i(),C(f?5:-1)}}function Mt(n,t){if(n&1&&(b(0,"p"),st(1),ct(2,"appTranslate"),v(),N(3,"p")),n&2){let e=t.$implicit;s(3);let o=m(0);i(),lt(pt(2,1,"i18n.common.errors.validations."+e,o.errors[e]))}}function Gt(n,t){if(n&1&&U(0,Mt,4,4,null,null,it),n&2){let e=s(2),o=m(0);$(e.getErrors(o.errors||null))}}function Bt(n,t){n&1&&F(0)}function Qt(n,t){if(n&1&&l(0,Bt,1,0,"ng-container",3),n&2){s();let e=m(7);s();let o=m(0);d("ngTemplateOutlet",e)("ngTemplateOutletContext",A(2,xt,o.valid))}}function zt(n,t){if(n&1){let e=j();b(0,"form",1),M("ngSubmit",function(){w(e);let r=s();return S(r.onSubmit())}),x(1),l(2,Nt,1,4,"ng-container"),U(3,jt,6,6,null,null,rt),b(5,"div",2),l(6,Gt,2,0),v(),x(7),l(8,Qt,1,4,"ng-container"),v()}if(n&2){let e=s(),o=m(0);d("formGroup",o)("ngClass",e.additionalClasses()),i();let r=g(e.templates().beforeFormTemplate);i(),C(r?2:-1),i(),$(e.formControlNames()),i(3),C(o.errors?6:-1),i();let u=g(e.templates().afterFormTemplate);i(),C(u?8:-1)}}var R=class n{patoControls=et(O,{read:_});_container=E("container",{read:_});_destroyRef=p(y);_formBuilder=p(Ft);data=a.required();additionalClasses=a();buildForm=h();formSubmit=h();formChange=h();_form=D(null);form=this._form.asReadonly();formKeys=[];templates=a({});identifier=c(()=>this.data().form.id);formControlNames=c(()=>Object.keys(this._form()?.controls||{}));ngOnInit(){this.initialize()}initialize(){this.initForm(),this.initSubscriptionsForControlValueChanges()}initForm(){let t=this.data();this._form.set(this._formBuilder.record({},{validators:t.form.validators,asyncValidators:t.form.asyncValidators,updateOn:t.form.updateOn||"change"})),Object.keys(t.controls).forEach(e=>{let o=t.controls[e];this.addControl(e,o)})}addControl(t,e){this._form()?.addControl(t,this._formBuilder.control(e.value,[...e.validators||[]],[...e.asyncValidators||[]]))}ngAfterViewInit(){this.buildForm.emit(this.form())}createForm(t,e){let o=this._container();o&&this.patoControls().map(r=>{let u=this._form()?.controls[t],f=o.createComponent(e.formFieldComponent);f.setInput("control",u),f.setInput("id",this.identifier()+"_"+t)})}initSubscriptionsForControlValueChanges(){let t=this.form();t&&this.formControlNames().forEach(e=>{this.data().controls[e].valueChangesSubscribe&&t.controls[e].valueChanges.pipe(W(),Q(this._destroyRef)).subscribe(o=>{this.formChange.emit({field:e,newValue:o})})})}getErrors(t){return t?Object.keys(t):[]}onSubmit(){let t=this.form();this.markAsTouched(),!(!t||t.invalid)&&t.valid&&this.formSubmit.emit({valid:t.valid,content:t.value})}markAsTouched(t=!0){let e=this.form();e?.markAsTouched(),e?.updateValueAndValidity()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=T({type:n,selectors:[["pato-form"]],viewQuery:function(e,o){e&1&&(L(o.patoControls,O,5,_),L(o._container,St,5,_)),e&2&&G(2)},inputs:{data:[1,"data"],additionalClasses:[1,"additionalClasses"],templates:[1,"templates"]},outputs:{buildForm:"buildForm",formSubmit:"formSubmit",formChange:"formChange"},decls:2,vars:2,consts:[["novalidate","",3,"formGroup","ngClass"],["novalidate","",3,"ngSubmit","formGroup","ngClass"],[1,"invalid-feedback","d-block"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"formControlName"]],template:function(e,o){if(e&1&&(x(0),l(1,zt,9,7,"form",0)),e&2){let r=g(o.form());i(),C(r?1:-1)}},dependencies:[P,B,dt,I,ht,Ct,_t,bt,vt,O,gt],encapsulation:2})};function qt(n,t){if(n&1&&(b(0,"span",1),N(1,"i",3),v()),n&2){let e=s();i(),d("ngClass","bi bi-"+e.icon())}}var It=class n{_patoFormComponent=p(R);_destroyRef=p(y);formField=a.required();placeholder=a("");debounceTimer=a(300);icon=a();autocomplete=a(!0);submitFormOnDebounce=a(!1);changeValue=h();debounce=h();control=c(()=>this.formField().control());id=c(()=>this.formField().id());additionalClasses=a();_value=D("");value=this._value.asReadonly();_disabled=D(!1);disabled=this._disabled.asReadonly();_debouncer=new H;type="text";ngOnInit(){this.initialize()}initialize(){this._debouncer.pipe(Q(this._destroyRef),J(this.debounceTimer())).subscribe(t=>{this.debounce.emit(t),this.submitFormOnDebounce()&&this._patoFormComponent.onSubmit()})}keyPress(t){this._onTouched(),this._onChange(t),console.log(t)}onBlur(){this._onTouched()}_onChange=()=>{};_onTouched=()=>{};registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}writeValue(t){t||(t=""),this._value.set(t)}setDisabledState(t){this._disabled.set(t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=T({type:n,selectors:[["pato-input"]],inputs:{formField:[1,"formField"],placeholder:[1,"placeholder"],debounceTimer:[1,"debounceTimer"],icon:[1,"icon"],autocomplete:[1,"autocomplete"],submitFormOnDebounce:[1,"submitFormOnDebounce"],additionalClasses:[1,"additionalClasses"]},outputs:{changeValue:"changeValue",debounce:"debounce"},decls:3,vars:12,consts:[["searchInput",""],[1,"input-group-text"],[1,"form-control",3,"keyup","blur","type","placeholder","value","id","ngClass"],[3,"ngClass"]],template:function(e,o){if(e&1){let r=j();l(0,qt,2,1,"span",1),b(1,"input",2,0),M("keyup",function(){w(r);let f=at(2);return S(o.keyPress(f.value))})("blur",function(){return w(r),S(o.onBlur())}),v()}e&2&&(C(o.icon()?0:-1),i(),nt("is-valid",o.control().validator&&o.control().valid&&o.control().touched)("is-invalid",o.control().validator&&o.control().invalid&&o.control().touched),d("type",o.type)("placeholder",o.placeholder())("value",o.value())("id",o.id())("ngClass",o.additionalClasses()),ot("disabled",o.disabled()?"disabled":null)("autocomplete",o.autocomplete()?"on":"off"))},dependencies:[P,B,I],encapsulation:2})};export{R as a,It as b};
