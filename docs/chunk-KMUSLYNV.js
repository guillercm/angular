import{a as yt}from"./chunk-W7JQM2JG.js";import{a as _t,c as Ct,d as ht,f as bt,g as vt,h as Ft,i as gt,k as P}from"./chunk-LKWVCNZG.js";import{a as Q,b as ft}from"./chunk-HQ6BEVK7.js";import{$b as U,Ac as g,Ba as Z,Bc as m,Cc as ct,Da as y,Db as T,Dd as I,Ec as A,Gc as pt,Ia as tt,Ic as dt,Ja as h,Jb as l,Ka as a,L as W,Ma as et,Na as D,Q as X,Tb as nt,Ub as d,Wb as it,Yb as _,Yc as c,Zb as rt,_b as at,ac as $,bc as b,cc as v,da as Y,dc as N,ec as F,f as J,fc as j,hc as M,ic as s,ka as p,md as B,pb as i,pc as L,pd as ut,qc as G,rc as st,sc as K,tc as lt,uc as mt,va as w,wa as S,wb as C,xb as E,yb as ot,zc as x}from"./chunk-MHIS6V2U.js";var wt=["container"],O=class n{_injector=p(Z);_container=E("container",{read:C});_destroyRef=p(y);_patoFormComponent=p(R);formControlName=a.required();_componentRef;_componentRefFormField;_componentInstance=c(()=>this._componentRef?.instance);_id=c(()=>this._patoFormComponent.identifier()+"_"+this.formControlName());_form=c(()=>this._patoFormComponent.form());_data=c(()=>this._patoFormComponent.data().controls[this.formControlName()]);_control=c(()=>this._form()?.controls[this.formControlName()]);ngOnInit(){this.initialize()}initialize(){this.createComponents(),this.setInputsOutputs(),this.setClasses()}createComponents(){let{component:t,formFieldComponent:e}=this._data(),o=this._container();if(!e||!o)return;console.log(o),this._componentRefFormField=o.createComponent(e),this._componentRefFormField.setInput("control",this._control()),this._componentRefFormField.setInput("id",this._id());let r=this._componentRefFormField.instance;this._componentRef=r.controlView().createComponent(t),console.log(this._componentRef),this._componentRef.setInput("formField",this._componentRefFormField.instance)}setInputsOutputs(){let t=this._data().args;if(!t)return;let{control:e={},formField:o={}}=t,r=this._componentRef,u=this._componentRefFormField,f=(H,z)=>{Object.keys(H).forEach(k=>{let V=H[k],q=z.instance[k];switch(typeof q){case"function":if(et(V)){let Vt=ft(V,{injector:this._injector}).subscribe(()=>z.setInput(k,V()));this._destroyRef.onDestroy(()=>Vt.unsubscribe())}else z.setInput(k,V);break;case"object":if(!(q instanceof tt))return;let Rt=q.subscribe(V);this._destroyRef.onDestroy(()=>Rt.unsubscribe())}})};f(e,r),f(o,u)}setClasses(){let t=this._data().classes;if(!t)return;let{control:e,formField:o}=t;e&&(this._componentRef.location.nativeElement.classList=e),o&&(this._componentRefFormField.location.nativeElement.classList=o)}writeValue(t){this._componentInstance().writeValue(t)}registerOnChange(t){this._componentInstance().registerOnChange(t)}registerOnTouched(t){this._componentInstance().registerOnTouched(t)}setDisabledState(t){this._componentInstance()?.setDisabledState?.(t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=T({type:n,selectors:[["pato-control"]],viewQuery:function(e,o){e&1&&L(o._container,wt,5,C),e&2&&G()},inputs:{formControlName:[1,"formControlName"]},features:[ct([{provide:_t,useExisting:Y(()=>n),multi:!0}])],decls:2,vars:0,consts:[["container",""]],template:function(e,o){e&1&&F(0,null,0)},dependencies:[I,P],encapsulation:2})};var Dt=["container"],It=n=>({formValid:n}),Pt=n=>({controlValid:n});function Nt(n,t){n&1&&F(0)}function Lt(n,t){if(n&1&&l(0,Nt,1,0,"ng-container",2),n&2){s();let e=m(2);s();let o=m(0);d("ngTemplateOutlet",e)("ngTemplateOutletContext",A(2,It,o.valid))}}function At(n,t){n&1&&F(0)}function kt(n,t){if(n&1&&l(0,At,1,0,"ng-container",2),n&2){s();let e=m(0),o=m(1);d("ngTemplateOutlet",e)("ngTemplateOutletContext",A(2,Pt,o))}}function Et(n,t){n&1&&F(0)}function jt(n,t){if(n&1&&l(0,Et,1,0,"ng-container",2),n&2){s();let e=m(1),o=m(4);d("ngTemplateOutlet",o)("ngTemplateOutletContext",A(2,Pt,e))}}function Mt(n,t){if(n&1&&(x(0)(1),l(2,kt,1,4,"ng-container"),N(3,"pato-control",3),x(4),l(5,jt,1,4,"ng-container")),n&2){let e=t.$implicit,o=s(2),r=m(0),u=g(o.templates()["before_"+e]);i(),g(r.controls[e].valid),i(),_(u?2:-1),i(),d("formControlName",e),i();let f=g(o.templates()["after_"+e]);i(),_(f?5:-1)}}function Gt(n,t){if(n&1&&(b(0,"p"),K(1),pt(2,"appTranslate"),v(),N(3,"p")),n&2){let e=t.$implicit;s(3);let o=m(0);i(),lt(dt(2,1,"i18n.common.errors.validations."+e,o.errors[e]))}}function Bt(n,t){if(n&1&&U(0,Gt,4,4,null,null,rt),n&2){let e=s(2),o=m(0);$(e.getErrors(o.errors||null))}}function Qt(n,t){n&1&&F(0)}function zt(n,t){if(n&1&&l(0,Qt,1,0,"ng-container",2),n&2){s();let e=m(8);s();let o=m(0);d("ngTemplateOutlet",e)("ngTemplateOutletContext",A(2,It,o.valid))}}function qt(n,t){if(n&1){let e=j();K(0),b(1,"form",0),M("ngSubmit",function(){w(e);let r=s();return S(r.onSubmit())}),x(2),l(3,Lt,1,4,"ng-container"),U(4,Mt,6,6,null,null,at),b(6,"div",1),l(7,Bt,2,0),v(),x(8),l(9,zt,1,4,"ng-container"),v()}if(n&2){let e=s(),o=m(0);mt(" ",o.pristine," "),i(),d("formGroup",o)("ngClass",e.additionalClasses()),i();let r=g(e.templates().beforeFormTemplate);i(),_(r?3:-1),i(),$(e.formControlNames()),i(3),_(o.errors?7:-1),i();let u=g(e.templates().afterFormTemplate);i(),_(u?9:-1)}}var R=class n{patoControls=ot(O,{read:C});_container=E("container",{read:C});_destroyRef=p(y);_formBuilder=p(gt);data=a.required();additionalClasses=a();buildForm=h();formSubmit=h();formChange=h();_form=D(null);form=this._form.asReadonly();formKeys=[];templates=a({});identifier=c(()=>this.data().form.id);formControlNames=c(()=>Object.keys(this._form()?.controls||{}));ngOnInit(){this.initialize()}initialize(){this.initForm(),this.initSubscriptionsForControlValueChanges()}initForm(){let t=this.data();this._form.set(this._formBuilder.record({},{validators:t.form.validators,asyncValidators:t.form.asyncValidators,updateOn:t.form.updateOn||"change"})),Object.keys(t.controls).forEach(e=>{let o=t.controls[e];this.addControl(e,o)})}addControl(t,e){this._form()?.addControl(t,this._formBuilder.control(e.value,[...e.validators||[]],[...e.asyncValidators||[]]))}ngAfterViewInit(){this.buildForm.emit(this.form())}createForm(t,e){let o=this._container();o&&this.patoControls().map(r=>{let u=this._form()?.controls[t],f=o.createComponent(e.formFieldComponent);f.setInput("control",u),f.setInput("id",this.identifier()+"_"+t)})}initSubscriptionsForControlValueChanges(){let t=this.form();t&&this.formControlNames().forEach(e=>{this.data().controls[e].valueChangesSubscribe&&t.controls[e].valueChanges.pipe(X(),Q(this._destroyRef)).subscribe(o=>{this.formChange.emit({field:e,newValue:o})})})}getErrors(t){return t?Object.keys(t):[]}onSubmit(){let t=this.form();this.markAsTouched(),!(!t||t.invalid)&&t.valid&&this.formSubmit.emit({valid:t.valid,content:t.value})}markAsTouched(t=!0){let e=this.form();e?.markAsTouched(),e?.updateValueAndValidity()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=T({type:n,selectors:[["pato-form"]],viewQuery:function(e,o){e&1&&(L(o.patoControls,O,5,C),L(o._container,Dt,5,C)),e&2&&G(2)},inputs:{data:[1,"data"],additionalClasses:[1,"additionalClasses"],templates:[1,"templates"]},outputs:{buildForm:"buildForm",formSubmit:"formSubmit",formChange:"formChange"},decls:2,vars:2,consts:[["novalidate","",3,"ngSubmit","formGroup","ngClass"],[1,"invalid-feedback","d-block"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"formControlName"]],template:function(e,o){if(e&1&&(x(0),l(1,qt,10,8)),e&2){let r=g(o.form());i(),_(r?1:-1)}},dependencies:[I,B,ut,P,bt,Ct,ht,vt,Ft,O,yt],encapsulation:2})};function Ut(n,t){if(n&1&&(b(0,"span",1),N(1,"i",3),v()),n&2){let e=s();i(),d("ngClass","bi bi-"+e.icon())}}var Ot=class n{_patoFormComponent=p(R);_destroyRef=p(y);formField=a.required();placeholder=a("");debounceTimer=a(300);icon=a();autocomplete=a(!0);submitFormOnDebounce=a(!1);changeValue=h();debounce=h();control=c(()=>this.formField().control());id=c(()=>this.formField().id());additionalClasses=a();_value=D("");value=this._value.asReadonly();_disabled=D(!1);disabled=this._disabled.asReadonly();_debouncer=new J;type="text";ngOnInit(){this.initialize()}initialize(){this._debouncer.pipe(Q(this._destroyRef),W(this.debounceTimer())).subscribe(t=>{this.debounce.emit(t),this.submitFormOnDebounce()&&this._patoFormComponent.onSubmit()})}keyPress(t){this._onTouched(),this._onChange(t),console.log(t)}onBlur(){this._onTouched()}_onChange=()=>{};_onTouched=()=>{};registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}writeValue(t){t||(t=""),this._value.set(t)}setDisabledState(t){this._disabled.set(t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=T({type:n,selectors:[["pato-input"]],inputs:{formField:[1,"formField"],placeholder:[1,"placeholder"],debounceTimer:[1,"debounceTimer"],icon:[1,"icon"],autocomplete:[1,"autocomplete"],submitFormOnDebounce:[1,"submitFormOnDebounce"],additionalClasses:[1,"additionalClasses"]},outputs:{changeValue:"changeValue",debounce:"debounce"},decls:3,vars:12,consts:[["searchInput",""],[1,"input-group-text"],[1,"form-control",3,"keyup","blur","type","placeholder","value","id","ngClass"],[3,"ngClass"]],template:function(e,o){if(e&1){let r=j();l(0,Ut,2,1,"span",1),b(1,"input",2,0),M("keyup",function(){w(r);let f=st(2);return S(o.keyPress(f.value))})("blur",function(){return w(r),S(o.onBlur())}),v()}e&2&&(_(o.icon()?0:-1),i(),it("is-valid",o.control().validator&&o.control().valid&&o.control().touched)("is-invalid",o.control().validator&&o.control().invalid&&o.control().touched),d("type",o.type)("placeholder",o.placeholder())("value",o.value())("id",o.id())("ngClass",o.additionalClasses()),nt("disabled",o.disabled()?"disabled":null)("autocomplete",o.autocomplete()?"on":"off"))},dependencies:[I,B,P],encapsulation:2})};export{R as a,Ot as b};
