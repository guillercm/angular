import{a as ue}from"./chunk-EZXNMEZH.js";import{a as de}from"./chunk-YPVP2U74.js";import{a as me}from"./chunk-LI6PD6B4.js";import{a as pe,b as fe}from"./chunk-5E5A7MPA.js";import{b as ne}from"./chunk-6SC4F2GT.js";import"./chunk-HUYJNUJC.js";import"./chunk-H3BM7GQS.js";import{a as ae,b as le}from"./chunk-FE3D3GWU.js";import{c as oe,d as se}from"./chunk-N732RDM7.js";import"./chunk-CCOCAEYR.js";import"./chunk-LKWVCNZG.js";import{a as q}from"./chunk-HQ6BEVK7.js";import{a as ce}from"./chunk-VVT4Q77C.js";import"./chunk-VGIZYUEZ.js";import"./chunk-GTJUILT2.js";import{a as re}from"./chunk-KP3CEOU7.js";import{$b as F,Da as I,Db as d,Dd as ie,Fb as $,Gc as Y,Hc as Z,Ja as N,Jb as U,Ka as b,La as z,Na as m,Ub as y,Yb as J,Yc as u,Zb as x,Zc as ee,ac as E,bc as a,cc as l,dc as c,ea as S,fc as R,hc as g,ic as K,ka as s,pb as p,pc as W,qc as X,sc as G,sd as te,tc as P,u as w,va as h,wa as _,xb as O}from"./chunk-MHIS6V2U.js";import{a as j,b as L}from"./chunk-75BJGDCN.js";var C=class r{_apiHandlerService=s(oe);_configService=s(se);_configApi=m(null);_gifs=m([]);gifs=this._gifs.asReadonly();constructor(){this.initialize()}initialize(){this._configApi.set(this._configService.config().apis.gifs)}getEndpoint(t){return this._apiHandlerService.getEndpoint(this._configApi,t)}searchTag(t,e=0,i=10){let o=new re().set("api_key",this._configApi()?.apiKey||"").set("limit",i).set("offset",e*i).set("q",t),n=this.getEndpoint("search");return this._apiHandlerService.get(n,{params:o,context:{id:"searchGifs",actionsWhileLoadingHttpRequest:[]}}).pipe()}setGifs(t){this._gifs.set(t)}addGifs(t){this._gifs.update(e=>[...e,...t])}static \u0275fac=function(e){return new(e||r)};static \u0275prov=S({token:r,factory:r.\u0275fac,providedIn:"root"})};var H=class r{_sessionService=s(le);_jsonHandler=s(ae);_querysHistory=m([]);querysHistory=this._querysHistory.asReadonly();limitQuerys=8;loadsQuerys(){this._querysHistory.set(this._sessionService.getItem("gifsQuerysHistory",[]))}addQuery(t){t=t.trim(),this._querysHistory.update(e=>(e=e.filter(i=>i.trim()!==t),[t,...e.slice(0,this.limitQuerys-1)])),this.saveHistoryQuerys()}removeQuerys(){this._querysHistory.set([]),this._sessionService.removeItem("gifsQuerysHistory")}saveHistoryQuerys(){this._sessionService.setItem("gifsQuerysHistory",this.querysHistory())}static \u0275fac=function(e){return new(e||r)};static \u0275prov=S({token:r,factory:r.\u0275fac,providedIn:"root"})};var D=class r{_scrollStates=m({});scrollStates=u(()=>this._scrollStates());getScrollState(t){return this.scrollStates()[t]||0}setScrollState(t,e){this._scrollStates.update(i=>L(j({},i),{[t]:e}))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=S({token:r,factory:r.\u0275fac,providedIn:"root"})};function ge(r,t){if(r&1){let e=R();a(0,"button",5),g("click",function(){let o=h(e).$implicit,n=K();return _(n.searchTag(o))}),G(1),Y(2,"titlecase"),l()}if(r&2){let e=t.$implicit;p(),P(Z(2,1,e))}}var A=class r{_destroyRef=s(I);_querysHistoryService=s(H);_scrollStateService=s(D);_gifsServices=s(C);tags=u(()=>this._querysHistoryService.querysHistory());ngOnInit(){this.initialize()}initialize(){this._querysHistoryService.loadsQuerys();let t=this.tags();t.length&&this.searchTag(t[0],!1)}searchTag(t,e=!0){this._gifsServices.searchTag(t).pipe(q(this._destroyRef),w(i=>i.data)).subscribe(i=>{e&&this._scrollStateService.setScrollState("gifs",0),this._gifsServices.setGifs(i),i.length&&this._querysHistoryService.addQuery(t)})}removeQuerys(){this._querysHistoryService.removeQuerys(),this._gifsServices.setGifs([])}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=d({type:r,selectors:[["features-gifs-sidebar"]],decls:10,vars:0,consts:[[1,"border-right","p-3"],[1,"row"],["label","Limpiar historial","variant","danger",3,"click"],[1,"list-group","list-reset"],[1,"list-group-item","list-group-item-action"],[1,"list-group-item","list-group-item-action",3,"click"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"h3"),G(2,"GifsApp"),l(),c(3,"hr"),a(4,"div",1)(5,"shared-button",2),g("click",function(){return i.removeQuerys()}),l()(),c(6,"hr"),a(7,"div",3),F(8,ge,3,3,"button",4,x),l()()),e&2&&(p(8),E(i.tags()))},dependencies:[ie,te,ce],encapsulation:2})};var B=class r{gif=b();static \u0275fac=function(e){return new(e||r)};static \u0275cmp=d({type:r,selectors:[["features-gifs-card"]],inputs:{gif:[1,"gif"]},decls:6,vars:3,consts:[[1,"card","mb-2","text-center","bg-dark","text-center"],[2,"width","100%","height","200px"],[3,"url","alt"],[1,"card-body","text-white"],[1,"card-text"]],template:function(e,i){if(e&1&&(a(0,"div",0)(1,"div",1),c(2,"shared-image",2),l(),a(3,"div",3)(4,"p",4),G(5),l()()()),e&2){let o,n,f;p(2),y("url",((o=i.gif())==null||o.images==null||o.images.downsized_medium==null?null:o.images.downsized_medium.url)||"")("alt",((n=i.gif())==null?null:n.title)||"No name"),p(3),P(((f=i.gif())==null?null:f.title)||"Not title")}},dependencies:[ne],encapsulation:2})};function ve(r,t){if(r&1&&c(0,"features-gifs-card",1),r&2){let e=t.$implicit;y("gif",e)}}var k=class r{gifs=b([]);static \u0275fac=function(e){return new(e||r)};static \u0275cmp=d({type:r,selectors:[["features-gifs-list"]],inputs:{gifs:[1,"gifs"]},decls:3,vars:0,consts:[[1,"row"],[1,"col","col-12","col-md-6","col-xxl-4",3,"gif"]],template:function(e,i){e&1&&(a(0,"div",0),F(1,ve,1,1,"features-gifs-card",1,x),l()),e&2&&(p(),E(i.gifs()))},dependencies:[B],encapsulation:2})};var V=class r{_elementRef=s(z);isAtBottom=N();scrollPadding=b(10);onScroll(t){let e=this._elementRef.nativeElement,i=e.scrollTop,o=e.clientHeight,n=e.scrollHeight,f=i+o+this.scrollPadding()>n;this.isAtBottom.emit({isAtBottom:f,scrollTop:i,elementRef:this._elementRef})}static \u0275fac=function(e){return new(e||r)};static \u0275dir=$({type:r,selectors:[["","sharedIsScrollToEnd",""]],hostBindings:function(e,i){e&1&&g("scroll",function(n){return i.onScroll(n)})},inputs:{scrollPadding:[1,"scrollPadding"]},outputs:{isAtBottom:"isAtBottom"}})};var ye=["scrollDiv"];function Se(r,t){r&1&&c(0,"core-spinner")}var T=class r{_destroyRef=s(I);_interceptorService=s(de);_gifsServices=s(C);_querysHistoryService=s(H);_scrollStateService=s(D);_scrollDiv=O("scrollDiv");_elementScrollDiv=u(()=>this._scrollDiv()?.nativeElement);form=m(null);_page=m(0);_lastQuery=m("");gifs=u(()=>this._gifsServices.gifs());gifsRequest=u(()=>this._interceptorService.getHttpRequestById("searchGifs"));isLoadingGifs=u(()=>this.gifsRequest()?.state==="loading");dataForm={form:{id:"gifs"},controls:{query:{component:fe,formFieldComponent:me,value:"",validators:[],args:{control:{placeholder:"Busca aqu\xED un gif...",autocomplete:!1},formField:{label:"Gif"}},classes:{formField:"mt-3 col-12",control:"input-group"}}}};effectScrollstate=ee(()=>{this.updateScrollTop()});updateScrollTop(){let t=this._elementScrollDiv();t&&(t.scrollTop=this._scrollStateService.getScrollState("gifs"))}ngAfterViewInit(){this.updateScrollTop()}buildForm(t){this.form.set(t)}executeSearch(t,e){return this._gifsServices.searchTag(t,e).pipe(q(this._destroyRef),w(i=>i.data))}onSubmit(t){let{query:e}=t.content;e=e.trim(),!(!e||!this._elementScrollDiv())&&(this._scrollStateService.setScrollState("gifs",0),this._lastQuery.set(e),this._page.set(0),this.executeSearch(e,this._page()).subscribe(o=>{this._gifsServices.setGifs(o),o.length&&this._querysHistoryService.addQuery(e),this.form()?.controls.query.patchValue("")}))}isAtBottom(t){let{isAtBottom:e,scrollTop:i}=t;if(this._scrollStateService.setScrollState("gifs",i),!e||this.gifsRequest()?.state==="loading")return;this._page.update(n=>n+1);let o=this._lastQuery()||this._querysHistoryService.querysHistory()[0];this.executeSearch(o,this._page()).subscribe(n=>{this._gifsServices.addGifs(n)})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=d({type:r,selectors:[["features-gifs-page"]],viewQuery:function(e,i){e&1&&W(i._scrollDiv,ye,5),e&2&&X()},decls:8,vars:3,consts:[["scrollDiv",""],[1,"row"],[1,"col-12"],["classes","row pb-4",3,"buildForm","formSubmit","data"],["sharedIsScrollToEnd","",1,"col-12","mt-4","overflow-y-auto","mh-rem-25",3,"isAtBottom"],[3,"gifs"]],template:function(e,i){if(e&1){let o=R();a(0,"div")(1,"div",1)(2,"div",2)(3,"pato-form",3),g("buildForm",function(f){return h(o),_(i.buildForm(f))})("formSubmit",function(f){return h(o),_(i.onSubmit(f))}),l()(),a(4,"div",4,0),g("isAtBottom",function(f){return h(o),_(i.isAtBottom(f))}),c(6,"features-gifs-list",5),U(7,Se,1,0,"core-spinner"),l()()()}e&2&&(p(3),y("data",i.dataForm),p(3),y("gifs",i.gifs()),p(),J(i.isLoadingGifs()?7:-1))},dependencies:[pe,k,V,ue],encapsulation:2})};var M=class r{static \u0275fac=function(e){return new(e||r)};static \u0275cmp=d({type:r,selectors:[["features-gifs-home-page"]],decls:5,vars:0,consts:[[1,"row"],[1,"col","col-12","col-md-5","col-xxl-4"],[1,"col","col-12","col-md-7","col-xxl-8"],[1,"flex-fill"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1),c(2,"features-gifs-sidebar"),l(),a(3,"div",2),c(4,"features-gifs-page",3),l()())},dependencies:[T,A],encapsulation:2})};export{M as default};
