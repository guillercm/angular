import{b as g}from"./chunk-FE3D3GWU.js";import{c as f,d as S}from"./chunk-N732RDM7.js";import{d as m}from"./chunk-HQ6BEVK7.js";import{J as l,Na as n,Yc as a,ea as o,ka as s,n as v,u}from"./chunk-MHIS6V2U.js";var p=class i{_user=n(null);user=this._user.asReadonly();isAdmin=a(()=>this._user()?.roles.includes("admin")??!1);isAuthenticated=a(()=>this._user()!==null);constructor(){}setUser(e){this._user.set(e)}removeUser(){this._user.set(null)}hasRole(e){let t=this._user();return t?t.roles.includes(e):!1}static \u0275fac=function(t){return new(t||i)};static \u0275prov=o({token:i,factory:i.\u0275fac,providedIn:"root"})};var h=class i{_sessionService=s(g);_token=n(null);token=this._token.asReadonly();constructor(){this.initialize()}initialize(){this._token.set(this._sessionService.getItem("token"))}setToken(e){this._token.set(e),this._sessionService.setItem("token",e)}removeToken(){this._token.set(null),this._sessionService.removeItem("token")}static \u0275fac=function(t){return new(t||i)};static \u0275prov=o({token:i,factory:i.\u0275fac,providedIn:"root"})};var _=class i{_apiHandlerService=s(f);_configService=s(S);_tokenService=s(h);_userContextService=s(p);_configApi=n(null);_authStatus=n("checking");token=a(()=>this._tokenService.token());constructor(){this.initialize()}initialize(){this._configApi.set(this._configService.config().apis.tesloshop)}getEndpoint(e){return this._apiHandlerService.getEndpoint(this._configApi,e)}checkStatusResource=m({loader:()=>this.checkStatus()});authStatus=a(()=>this._authStatus()==="checking"?"checking":this._userContextService.isAuthenticated()?"authenticated":"not-authenticated");login(e,t){let r=this.getEndpoint("login");return this._apiHandlerService.post(r,{email:e,password:t}).pipe(u(c=>this.handleAuthSuccess(c)),l(c=>this.handleAuthError(c)))}register(e,t,r){let c=this.getEndpoint("register");return this._apiHandlerService.post(c,{email:e,password:t,fullName:r}).pipe(u(d=>this.handleAuthSuccess(d)),l(d=>this.handleAuthError(d)))}checkStatus(){if(!this.token())return this.logout(),v(!1);let t=this.getEndpoint("checkStatus");return this._apiHandlerService.get(t,{}).pipe(u(r=>this.handleAuthSuccess(r)),l(r=>this.handleAuthError(r)))}logout(){this._userContextService.removeUser(),this._authStatus.set("not-authenticated"),this._tokenService.removeToken()}handleAuthSuccess({token:e,user:t}){return this._userContextService.setUser(t),this._authStatus.set("authenticated"),this._tokenService.setToken(e),!0}handleAuthError(e){return this.logout(),v(!1)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=o({token:i,factory:i.\u0275fac,providedIn:"root"})};export{p as a,_ as b};
